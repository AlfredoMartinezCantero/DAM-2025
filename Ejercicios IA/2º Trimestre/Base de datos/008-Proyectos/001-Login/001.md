# Introducción:
En esta práctica he implementado un sistema completo de Login utilizando PHP y MySQL, dividiendo la lógica en la creación de la infraestructura de datos y el control de sesiones, primero he trabajado con los scripts SQL (001-creamos base de datos.sql y 002-creamos usuario.sql) para establecer una base de datos llamada superaplicacion y un usuario con permisos restringidos, entendiendo que por seguridad no debemos usar root en la aplicación final.

Luego he desarrollado el archivo procesa.php, aquí he aprendido que para verificar las credenciales de forma segura debo utilizar sentencias preparadas en lugar de concatenar variables directamente en la consulta SQL, evitando así la inyección SQL, he utilizado la función `password_verify` para comprobar la contraseña y, si los datos son correctos, inicializo el almacenamiento de memoria del servidor mediante `session_start()` y guardo el nombre del usuario en la superglobal `$_SESSION`.

Por último, en `exito.php`, he implementado un mecanismo de control de acceso, utilizando la función `isset()`, verifico si la variable de sesión existe, si no es así, redirijo al usuario fuera de la página, protegiendo el contenido de accesos no autorizados.


**BBDD**

---
```
-- creamos base de datos
CREATE DATABASE IF NOT EXISTS superaplicacion;
USE superaplicacion;

CREATE TABLE usuarios (
    id INT AUTO_INCREMENT PRIMARY KEY,
    nombre_usuario VARCHAR(50) NOT NULL UNIQUE,
    password VARCHAR(255) NOT NULL, -- Almacenará el HASH, no el texto plano
    nombre_completo VARCHAR(100)
);

-- Insertamos un usuario de prueba (La contraseña es '1234' hasheada)
INSERT INTO usuarios (nombre_usuario, password, nombre_completo) 
VALUES ('admin', '$2y$10$e.g./exampleHashFor1234...', 'Administrador del Sistema');

-- creamos usuario.sql
-- Creamos un usuario específico para la aplicación por seguridad
CREATE USER 'app_user'@'localhost' IDENTIFIED BY 'App_Secure_Pass$2025';
GRANT SELECT, INSERT, UPDATE ON superaplicacion.* TO 'app_user'@'localhost';
FLUSH PRIVILEGES;
```
---

**LOGIN**

---
```
<?php
session_start(); // Iniciamos el motor de sesiones

$host = "localhost";
$user = "app_user";
$pass = "App_Secure_Pass$2025";
$db   = "superaplicacion";

$conexion = new mysqli($host, $user, $pass, $db);

if ($conexion->connect_error) {
    die("Error de conexión: " . $conexion->connect_error);
}

// Recogemos los datos del formulario de forma segura
if ($_SERVER["REQUEST_METHOD"] == "POST") {
    $usuario = $_POST['usuario'];
    $password_ingresada = $_POST['password'];

    $sql = "SELECT id, nombre_usuario, password FROM usuarios WHERE nombre_usuario = ?";
    
    $stmt = $conexion->prepare($sql);
    $stmt->bind_param("s", $usuario);
    $stmt->execute();
    $resultado = $stmt->get_result();

    if ($fila = $resultado->fetch_assoc()) {
        // Verificamos la contraseña hasheada
        if (password_verify($password_ingresada, $fila['password'])) {
            // LOGIN EXITOSO: Creamos la sesión
            $_SESSION['usuario'] = $fila['nombre_usuario'];
            $_SESSION['id'] = $fila['id'];
            
            // Redirigimos a la zona privada
            header("Location: exito.php");
            exit(); 
        } else {
            // Contraseña incorrecta
            echo "Error: Credenciales inválidas.";
        }
    } else {
        // Usuario no encontrado
        echo "Error: El usuario no existe.";
    }

    $stmt->close();
}
$conexion->close();
?>
```
---

**ENTRADA**

---
```
<?php
session_start();

// Si la variable 'usuario' no está definida en la sesión, expulsamos al visitante.
if (!isset($_SESSION['usuario'])) {
    echo "<h1>ACCESO DENEGADO</h1>";
    echo "<p>Has intentado colar, pero el sistema de sesiones te ha detectado.</p>";
    echo "<a href='index.html'>Volver al Login</a>";
    // Detenemos la ejecución del script para que no se cargue nada más
    exit(); 
}
?>

<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Panel de Control</title>
</head>
<body>
    <h1>¡Bienvenido, <?php echo htmlspecialchars($_SESSION['usuario']); ?>!</h1>
    <p>Has iniciado sesión con éxito en la SuperAplicación.</p>
    
    <hr>
    <a href="logout.php">Cerrar Sesión</a>
</body>
</html>
```
---
# Conclusión:
Con este ejercicio he entendido la base de la seguridad en aplicaciones web, comprendiendo que el protocolo HTTP no guarda estados y que es responsabilidad nuestra, mediante `session_start()` y las variables `$_SESSION`, mantener la identidad del usuario entre diferentes páginas, además he aprendido a conectar PHP con MySQL de forma segura utilizando sentencias preparadas para validar credenciales.

Un error muy común es olvidar poner `exit()` inmediatamente después de usar la función `header("Location: ...")`, si no se detiene el script el código que hay debajo de la redirección, incluyendo información confidencial de la página protegida, seguiría ejecutándose y enviándose al navegador, lo que supone un grave fallo de seguridad aunque el usuario visualmente sea redirigido.